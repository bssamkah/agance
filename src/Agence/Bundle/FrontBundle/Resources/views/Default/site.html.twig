{% extends "AgenceFrontBundle::layout_standar.html.twig" %}
{% block body %}
    <div id="wrapper">
        <input style="width: 50%;" type="text" class="form-control" id="pac-input2" placeholder="Entrer ici votre rÃ©gion" autocomplete="on" size="60">
        <div id="content" class="mob-max" >

            <div class="col-lg-12"><div class="row mb20">
                </div>
                <div class="row">

                    <div class="rightContainer">
                        <h3>Listes des offres</h3>
                        <div class="row">
                            {% for offre in offres %}
                                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                                    <div class="card">
                                        <div class="figure"><a href="{{ path('offre_show',{'id' : offre.id }) }}">
                                                <img src="{{ asset('images/prop/1-1.png') }}" alt="image">
                                                <div class="figCaption">
                                                    <div>${{ offre.prix}}</div>
                                                    <span class="icon-eye"> 200</span>
                                                    <span class="icon-heart"> 54</span>
                                                    <span class="icon-bubble"> 13</span>
                                                </div>
                                                <div class="figView"><span class="icon-eye"></span></div>
                                                <div class="figType">{{ offre.type }}</div>
                                            </a> </div>
                                        <h2>{{ offre.titre }}</h2>
                                        <div class="cardAddress"><span class="icon-pointer"></span> {{ offre.lieu }}</div>
                                        <div class="cardRating">
                                            <span class="fa fa-star"></span>
                                            <span class="fa fa-star"></span>
                                            <span class="fa fa-star"></span>
                                            <span class="fa fa-star"></span>
                                            <span class="fa fa-star-o"></span>
                                            (146)

                                        </div>

                                        <ul class="cardFeat">
                                            <li><span class="fa fa-moon-o"></span> 3</li>
                                            <li><span class="icon-drop"></span> 2</li>
                                            <li><span class="icon-frame"></span> 3430 m&#178;</li>
                                            {% set favoris =  offre.offrefavoris %}
                                            {%set i = 0 %}
                                            {% for favori in favoris %}
                                            {% if favori.client == app.user %}
                                            {%set i =  1 %}
                                            {% else %}
                                            {%set i =  0 %}
                                             {% endif %}
                                                {% endfor %}
                                            
                                            {% if i == 1 %}
                                            <li style="margin-left: 4%;"><a id="ajouterFavoris1" class="btn btn-o btn-yellow active" href="#" data-toggle="button">
                                                    <span class="fa fa-star-o state"></span><span>favoris</span>
                                                    <span class="fa fa-star text-white state-active"></span>
                                                </a><a style="display: none;" class="loader" id="loaderfavoris1"> <img src="/agance/web/ajax-loader-favoris.gif"></a>
                                            </li>
                                            {% else %}
                                                 <li style="margin-left: 4%;">
                                                <a id="ajouterFavoris{{offre.id}}" class="btn btn-o btn-yellow" href="#" data-toggle="button">
                                                    <span class="fa fa-star-o state"></span><span>Ajouter aux favoris</span>
                                                    <span class="fa fa-star text-white state-active"></span>
                                                </a>
                                                <a style="display: none;" class="loader" id="loaderfavoris{{offre.id}}"> <img src="{{asset('ajax-loader-favoris.gif') }}"></a>
                                            </li>
                                            
                                            {% endif %}
                                            <li id=hidid{{offre.id}} style="display: none;margin-left: 4%;"><a id="ajouterFavoris1" class="btn btn-o btn-yellow active" href="#" data-toggle="button">
                                                    <span class="fa fa-star-o state"></span><span>favoris</span>
                                                    <span class="fa fa-star text-white state-active"></span>
                                                </a><a style="display: none;" class="loader" id="loaderfavoris1"> <img src="/agance/web/ajax-loader-favoris.gif"></a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>

                                    </div>

                                </div>
                                            {% endfor %}


                        </div>

                    </div>


                </div>
            </div>

        </div>
        <div id="map-offre-add" style="height: 100%" class="mob-min"></div>

    </div>

{% endblock %}

{% block javascript %}
    <script>
        {% for offre in offres %}
            $('#ajouterFavoris{{offre.id}}').click(function(){
               $('#loaderfavoris{{offre.id}}').show();
                $('#ajouterFavoris{{offre.id}}').hide();
           
                    var id = "{{offre.id}}"
                    $.ajax({
                    type: "POST",
                            url: "{{path('add_favoris')}}",
                            data: {id:id},
                            dataType: 'json',
                            success: function () {

                           $('#loaderfavoris{{offre.id}}').hide();
                           $('#hidid{{offre.id}}').show();
                            }
                    });
                     });
           {% endfor %}
    </script>
    <script>

                function initialize() {
                var mapOptions = {
                center: {lat: - 34.397, lng: 150.644},
                        zoom: 15,
                        mapTypeId: google.maps.MapTypeId.HYBRID
                };
                        var markerevent;
                        var geocoder;
                        geocoder = new google.maps.Geocoder();
                        var mapAddOf = new google.maps.Map(document.getElementById('map-offre-add'),
                                mapOptions);
                        if (navigator.geolocation) {

                navigator.geolocation.getCurrentPosition(function(position) {

                var posOffre = new google.maps.LatLng(position.coords.latitude,
                        position.coords.longitude);
                        var newMarker = new google.maps.Marker({
                        position: posOffre,
                                map: mapAddOf,
                                icon: new google.maps.MarkerImage('../images/marker-red.png'),
                                draggable: false,
                                animation: google.maps.Animation.DROP

                        });
                        mapAddOf.setCenter(posOffre);
                }, function() {
                handleNoGeolocation(true);
                });
                } else {
                handleNoGeolocation(false);
                }

                var input = (document.getElementById('pac-input2'));
                        mapAddOf.controls[google.maps.ControlPosition.TOP_CENTER].push(input);
                        var searchBox = new google.maps.places.SearchBox((input));
                        google.maps.event.addListener(searchBox, 'places_changed', function() {
                        var places = searchBox.getPlaces();
                                if (places.length == 0) {
                        return;
                        }

                        markers = [];
                                var bounds = new google.maps.LatLngBounds();
                                for (var i = 0, place; place = places[i]; i++) {
                        var image = {
                        url: place.icon,
                                size: new google.maps.Size(71, 71),
                                origin: new google.maps.Point(0, 0),
                                anchor: new google.maps.Point(17, 34),
                                scaledSize: new google.maps.Size(25, 25)
                        };
                                bounds.extend(place.geometry.location);
                        }

                        mapAddOf.fitBounds(bounds);
                                mapAddOf.setZoom(15);
                        });
                        google.maps.event.addListener(mapAddOf, 'bounds_changed', function() {
                        var bounds = mapAddOf.getBounds();
                                searchBox.setBounds(bounds);
                        });
                }
        google.maps.event.addDomListener(window, 'load', initialize);



    </script>
{% endblock %}
